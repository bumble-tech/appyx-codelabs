
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Animating transitions with Appyx</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="appyx-custom-animation"
                  title="Animating transitions with Appyx"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Getting started" duration="1">
        <h2 is-upgraded>Before you begin</h2>
<p>In the previous <a href="www.previouscodelab.bumble" target="_blank">codelab</a> we&#39;ve seen how to navigate using Appyx. Now we&#39;re going to leverage the power of Appyx transition handlers.</p>
<h2 is-upgraded>What you&#39;ll do</h2>
<ol type="1">
<li>Model the animation with states</li>
<li>Associate the states with UI properties</li>
<li>Use a custom transition handler</li>
</ol>
<h2 is-upgraded>What you&#39;ll build</h2>
<p class="image-container"><img alt="demo" style="width: 200.00px" src="img/e1c53888614e145.gif"></p>
<h2 is-upgraded>Access the code</h2>
<p>Clone the repo and open the <code>CustomAnimation</code> project.</p>
<pre><code>git clone git@github.com:bumble-tech/appyx-codelabs.git

</code></pre>
<p>This tutorial and the <code>TODOs</code> will help you add great transitions between screens.</p>
<p>If at any point you&#39;re feeling stuck, you can always check out the solution inside the project.</p>
<aside class="special"><p>The <strong>appyx-codelabs</strong> repo contains starter code for all codelabs in the pathway.<br> For this codelab, use the <strong>CustomAnimation</strong> project. </p>
<ul>
<li><strong>CustomAnimation</strong> â€” Project that contains the starter and finished code for this codelab.</li>
</ul>
<p> The project contains two modules:<br></p>
<ul>
<li><strong>app</strong> â€“ Contains the starter code for this project. Make your changes here to complete the codelab.</li>
<li><strong>solution</strong> â€“ Contains the solution to this codelab.</li>
</ul>
</aside>
<p>Check our <a href="https://bumble-tech.github.io/appyx/" target="_blank">official page</a> for the latest release.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Describe state transitions" duration="1">
        <p>Relevant pages from the Appyx project page:</p>
<ul>
<li><a href="https://bumble-tech.github.io/appyx/navmodel/backstack/" target="_blank">BackStack</a></li>
</ul>
<p>In this example we&#39;re using a <code>BackStack</code>. This defines 4 states for a child:</p>
<ul>
<li><code>CREATED</code></li>
<li><code>ACTIVE</code></li>
<li><code>STASHED</code></li>
<li><code>DESTROYED</code></li>
</ul>
<p>The diagram below illustrates the transitions from one state to the next:</p>
<p class="image-container"><img alt="backstack states" style="width: 400.00px" src="img/60fc505fd096360e.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Defining UI properties" duration="0">
        <p>Relevant pages from the Appyx project page:</p>
<ul>
<li><a href="https://bumble-tech.github.io/appyx/ui/transitions/" target="_blank">Transitions</a></li>
</ul>
<p>When navigating with Appyx, we can animate any UI property that we can represent with a Compose <code>Modifier</code>.</p>
<p>It&#39;s very easy to do so! In this case, we&#39;ll want scale, offset, and alpha animations. Let&#39;s add the following inside <code>CustomTransitionHandler</code>:</p>
<pre><code>private data class Props(
    val scale: Float = 1f,
    val offset: Offset = Offset.Zero,
    val alpha: Float = 1f
)

</code></pre>
<p>Next, let&#39;s define some actual values representing our key states.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Fade to the next item" duration="0">
        <p>The first thing we&#39;ll do is crossfade between states.</p>
<h2 is-upgraded>How properties map to states</h2>
<p>Let&#39;s start off with creating different props instances:</p>
<pre><code>private val created = Props()
private val active = created.copy(alpha = 1f)
private val stashed = active.copy(alpha = 0f)
private val destroyed = stashed

</code></pre>
<p>Read alpha values as a percentage, where <code>0</code> = <code>0%</code> (hidden), <code>1</code> = <code>100%</code> (completely visible).</p>
<p>Here we&#39;re saying that when an element is</p>
<ul>
<li><code>CREATED</code> or <code>ACTIVE</code>,  it should be visible</li>
<li><code>STASHED</code> or <code>DESTROYED</code> it should be invisible</li>
</ul>
<p>Now let&#39;s define the mappings between the current state and the UI properties:</p>
<pre><code>private fun BackStack.State.toProps(): Props =
    when(this) {
        BackStack.State.CREATED -&gt; created
        BackStack.State.ACTIVE -&gt; active
        BackStack.State.STASHED -&gt; stashed
        BackStack.State.DESTROYED -&gt; destroyed
    }

</code></pre>
<h2 is-upgraded>Animating property changes</h2>
<p>Let&#39;s add this to our <code>Modifier</code>. We&#39;re mapping the current state (<code>it</code> inside the <code>animateFloat</code> block) to a props value (<code>.toProps()</code>)</p>
<pre><code>override fun createModifier(
    modifier: Modifier,
    transition: Transition&lt;BackStack.State&gt;,
    descriptor: TransitionDescriptor&lt;NavTarget, BackStack.State&gt;
): Modifier = modifier.composed {

    val alpha by transition.animateFloat(
        transitionSpec = floatSpec,
        targetValueByState = { it.targetProps().alpha },
        label = &#34;&#34;
    )

    this
        .alpha(alpha)
}

</code></pre>
<p>To use the newly updated <code>TransitionHandler</code> open up your <code>RootNode</code> and replace</p>
<p><code>rememberBackstackSlider()</code></p>
<p>with</p>
<p><code>remeberCustomTransitionHandler()</code></p>
<p>Your app should look like this:</p>
<p class="image-container"><img alt="demo" style="width: 200.00px" src="img/b8ec24288a317aac.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Slide in from the bottom" duration="0">
        <p>This was neat and simple, but let&#39;s kick it up a notch!</p>
<p>When we&#39;re creating a new item let&#39;s push it in from the bottom of the screen.</p>
<p>Change your <code>toProps</code> function:</p>
<pre><code>private fun BackStack.State.toProps(height: Float): Props =
    when (this) {
        BackStack.State.CREATED -&gt; created.copy(offset = Offset(0f, 2f * height))
        BackStack.State.ACTIVE -&gt; active
        BackStack.State.STASHED -&gt; stashed
        BackStack.State.DESTROYED -&gt; destroyed
    }

</code></pre>
<p>Add this to your <code>Modifier</code>.</p>
<pre><code>override fun createModifier(
    modifier: Modifier,
    transition: Transition&lt;BackStack.State&gt;,
    descriptor: TransitionDescriptor&lt;NavTarget, BackStack.State&gt;
): Modifier = modifier.composed {
    val height = descriptor.params.bounds.height.value // we get access to width &amp; height here
    ...

    val offset by transition.animateOffset(
        transitionSpec = transitionSpec,
        targetValueByState = { it.toProps(height).offset }, 
        label = &#34;&#34;
    )

    this
        .offset {
            IntOffset(
                x = (offset.x * density).roundToInt(),
                y = (offset.y * density).roundToInt()
            )
        }
        .alpha(alpha)
}

</code></pre>
<p>Your app should look like this:</p>
<p class="image-container"><img alt="demo" style="width: 200.00px" src="img/672ece1ee234b550.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Make it explosive" duration="0">
        <p>For our final trick, let&#39;s make our screen explode when it&#39;s destroyed.</p>
<p>To do this, when it transitions to <code>DESTROYED</code> we&#39;ll scale it up.</p>
<p>Change the properties like this:</p>
<pre><code>private val created = Props(alpha = 0.5f)
private val active = created.copy(alpha = 1f, scale = 1f)
private val stashed = active.copy(alpha = 0f, scale = 0.6f)
private val destroyed = stashed.copy(scale = 1.25f)

</code></pre>
<p>Add this to your <code>Modifier</code>.</p>
<pre><code>override fun createModifier(
    modifier: Modifier,
    transition: Transition&lt;BackStack.State&gt;,
    descriptor: TransitionDescriptor&lt;NavTarget, BackStack.State&gt;
): Modifier = modifier.composed {

    ...

    val scale by transition.animateFloat(
        transitionSpec = floatSpec,
        targetValueByState = { it.toProps(height).scale },
        label = &#34;&#34;
    )

    this
        .offset {
            IntOffset(
                x = (offset.x * density).roundToInt(),
                y = (offset.y * density).roundToInt()
            )
        }
        .scale(scale)
        .alpha(alpha)
}

</code></pre>
<p>That&#39;s it!</p>


      </google-codelab-step>
    
      <google-codelab-step label="Launch" duration="1">
        <p>Launch your app. It should look like this:</p>
<p class="image-container"><img alt="demo" style="width: 200.00px" src="img/e1c53888614e145.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Where to go from here" duration="0">
        <p>ðŸŽ‰ Congrats for completing this codelab! ðŸŽ‰</p>
<p>Check out other code labs to learn more about Appyx.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
